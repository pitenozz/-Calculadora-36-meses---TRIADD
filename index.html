<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora 36 meses</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #f1f8e9);
      margin: 0; padding: 0;
      display: flex; justify-content: center; align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #fff; padding: 30px; margin-top: 40px;
      border-radius: 16px; box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      width: 600px; text-align: center;
    }
    h2 { color: #2c3e50; margin-bottom: 10px; font-weight: 600; }
    label { display: block; margin-top: 15px; font-weight: 600; color: #34495e; text-align: left; }
    input[type="date"] {
      padding: 10px; margin-top: 5px; width: 100%;
      border: 1px solid #ccc; border-radius: 8px; font-size: 14px;
    }
    .actions { display:flex; gap:10px; margin-top: 12px; }
    button {
      flex:1; margin-top: 10px; padding: 12px 18px; border: none; border-radius: 8px;
      background: #3498db; color: #fff; font-weight: 600; cursor: pointer;
      transition: all 0.3s ease;
    }
    button:hover { background: #2980b9; transform: scale(1.05); }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; border-radius: 8px; overflow: hidden; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; font-size: 14px; }
    th { background: #3498db; color: #fff; }
    tr:nth-child(even) { background: #f9f9f9; }
    tr:nth-child(odd) { background: #eef7fb; }
    .card { background: #ecf0f1; padding: 15px; border-radius: 10px; margin-top: 15px; font-size: 15px; text-align:left; }
    .progress-container {
      width: 100%; background: #ddd; border-radius: 10px; margin-top: 20px;
      height: 30px; overflow: hidden; position: relative;
    }
    .progress-bar {
      height: 100%; width: 0%; text-align: center; color: #fff; font-weight: bold;
      line-height: 30px; transition: width 0.8s ease, background 0.5s ease;
    }
    .progress-text {
      position: absolute; width: 100%; text-align: center; top: 0; left: 0;
      line-height: 30px; font-weight: 600; color: #2c3e50;
    }
    footer { margin-top: 25px; font-size: 12px; color: #7f8c8d; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Calculadora 36 meses</h2>

    <!-- Evite <form> para n√£o submeter; se usar, mantenha type="button" -->
    <div class="form">
      <label>Data inicial:
        <input type="date" id="dataInicial" />
      </label>
      <label>Data final:
        <input type="date" id="dataFinal" />
      </label>
      <div class="actions">
        <button type="button" onclick="adicionarPeriodo()">Adicionar Per√≠odo</button>
        <button type="button" onclick="limpar()">Limpar</button>
      </div>
    </div>

    <div id="listaPeriodos">
      <h3>Per√≠odos adicionados:</h3>
      <table>
        <thead>
          <tr>
            <th>Data Inicial</th>
            <th>Data Final</th>
            <th>Per√≠odo</th>
            <th>Somat√≥rio Parcial</th>
          </tr>
        </thead>
        <tbody id="periodos"></tbody>
      </table>
    </div>

    <div id="resultado" class="card"></div>

    <div class="progress-container">
      <div id="progressBar" class="progress-bar"></div>
      <div id="progressText" class="progress-text">0% - Em andamento</div>
    </div>

    <footer>Desenvolvido por TRIADD Assessoria Financeira</footer>
  </div>

  <script>
    // Estado
    let totalDias = 0;
    let periodos = [];

    // Parse robusto: aceita yyyy-mm-dd do input de data
    function parseDate(str) {
      if (!str || !/^\d{4}-\d{2}-\d{2}$/.test(str)) return null;
      const [y, m, d] = str.split('-').map(Number);
      // Meio-dia reduz riscos de DST afetar diferen√ßa
      return new Date(y, m - 1, d, 12);
    }

    // Diferen√ßa inclusiva (inclui dia inicial e final) com prote√ß√£o a DST
    function diffDiasEntre(inicio, fim) {
      const msPorDia = 1000 * 60 * 60 * 24;
      // Normaliza ambos para meio-dia do dia correspondente
      const i = new Date(inicio.getFullYear(), inicio.getMonth(), inicio.getDate(), 12);
      const f = new Date(fim.getFullYear(), fim.getMonth(), fim.getDate(), 12);
      // round neutraliza pequenos desvios; +1 inclui o dia inicial
      return Math.round((f - i) / msPorDia) + 1;
    }

    function formatBR(date) {
      const d = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12);
      return d.toLocaleDateString('pt-BR');
    }

    function atualizarBarra(totalMeses) {
      const progresso = Math.min((Number(totalMeses) / 36) * 100, 100);
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");
      progressBar.style.width = progresso + "%";

      if (progresso <= 50) progressBar.style.background = "#f1c40f";
      else if (progresso <= 75) progressBar.style.background = "#e67e22";
      else if (progresso < 100) progressBar.style.background = "#2ecc71";
      else progressBar.style.background = "#27ae60";

      progressText.textContent = progresso < 100 ? Math.floor(progresso) + "% - Em andamento" : "100% - Conclu√≠do";
    }

    function atualizarResultado() {
      const totalMeses = totalDias / 30.44;
      const totalAnos = totalDias / 365.25;
      const mesesFaltando = Math.max(36 - totalMeses, 0);
      const diasFaltando = Math.max(Math.floor((36 * 30.44) - totalDias), 0);

      const status = totalMeses >= 36
        ? "‚úÖ Requisito de 36 meses atingido!"
        : `‚è≥ Ainda faltam ${mesesFaltando.toFixed(1)} meses (${diasFaltando} dias).`;

      document.getElementById("resultado").innerHTML = `
        <strong>Total acumulado:</strong><br>
        üìÜ ${totalMeses.toFixed(1)} meses<br>
        üìÖ ${totalDias} dias<br>
        üìÖ ${totalAnos.toFixed(1)} anos<br><br>
        ${status}
      `;
      atualizarBarra(totalMeses);
    }

    function adicionarPeriodo() {
      const inicioStr = document.getElementById("dataInicial").value;
      const fimStr = document.getElementById("dataFinal").value;

      const inicio = parseDate(inicioStr);
      const fim = parseDate(fimStr);

      if (!inicio || !fim) {
        alert("Por favor, preencha as duas datas.");
        return;
      }
      if (fim < inicio) {
        alert("A data final deve ser posterior ou igual √† inicial.");
        return;
      }

      // Previne duplicidade exata
      const duplicado = periodos.some(p => p.inicio === inicioStr && p.fim === fimStr);
      if (duplicado) {
        alert("Este per√≠odo j√° foi adicionado.");
        return;
      }

      const dias = diffDiasEntre(inicio, fim);
      if (!Number.isFinite(dias) || dias <= 0) {
        alert("Per√≠odo inv√°lido. Verifique as datas.");
        return;
      }

      // Acumula
      totalDias += dias;
      periodos.push({ inicio: inicioStr, fim: fimStr, dias });

      // Atualiza tabela
      const parcialMeses = totalDias / 30.44;
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${formatBR(inicio)}</td>
        <td>${formatBR(fim)}</td>
        <td>${(dias / 30.44).toFixed(1)} meses (${dias} dias)</td>
        <td>${parcialMeses.toFixed(1)} meses (${totalDias} dias)</td>
      `;
      document.getElementById("periodos").appendChild(row);

      // Atualiza resumo e barra
      atualizarResultado();

      // Limpa inputs para facilitar novo registro
      document.getElementById("dataInicial").value = "";
      document.getElementById("dataFinal").value = "";
    }

    function limpar() {
      totalDias = 0;
      periodos = [];
      document.getElementById("periodos").innerHTML = "";
      document.getElementById("resultado").innerText = "";
      document.getElementById("dataInicial").value = "";
      document.getElementById("dataFinal").value = "";
      atualizarBarra(0);
      document.getElementById("progressText").textContent = "0% - Em andamento";
    }

    // Garante fun√ß√µes acess√≠veis ao onclick no escopo global
    window.adicionarPeriodo = adicionarPeriodo;
    window.limpar = limpar;
  </script>
</body>
</html>
